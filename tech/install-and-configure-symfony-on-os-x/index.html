<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Todd Sullivan"/>

<!-- START UPDATE -->
<meta name="description" content="Install and Configure Symfony on OS X">
<title>Install and Configure Symfony on OS X</title>
<!-- END UPDATE -->

<link rel="stylesheet" type="text/css" href="/assets/18/css/main.css">
<link rel="alternate" type="application/rss+xml" title="Todsul - Startups, Adventure, Tech" href="http://todsul.com/feed.xml">

</head>

<body>

<section id="social">
<div class="line"></div>
<a href="https://twitter.com/todsul" target="_blank" rel="nofollow"><i>t</i></a>
<a href="http://dribbble.com/todsul" target="_blank" rel="nofollow"><i>d</i></a>
<a href="/feed.xml" target="_blank"><i>r</i></a>
</section>

<a id="logo" href="/"><img src="/assets/18/image/fox.svg" alt="Todsul Blog"></a>

<header>

<!-- START UPDATE -->
<h1>Install and Configure Symfony on OS X</h1>
<time datetime="2013-05-05" pubdate>May 2013</time>
<!-- END UPDATE -->

</header>

<!-- START UPDATE -->
<p>This is to setup Apache, MySQL and PHP for Symfony on Mac OS X. It includes setting up a virtual host, self-signed SSL certificate, git repository, and the database on ramdisk to increase PHPUnit speed.</p>

<h2>Configure Apache</h2>

<p>Use vi to configure the httpd.conf file.</p>

<pre><code>sudo vi /etc/apache2/httpd.conf
</code></pre>

<p>Enable PHP and virtual hosts by uncommenting these lines:</p>

<pre><code>LoadModule php5_module libexec/apache2/libphp5.so
...
Include /private/etc/apache2/extra/httpd-vhosts.conf
...
Include /private/etc/apache2/extra/httpd-ssl.conf
</code></pre>

<p>Create a conf file to give your user permissions.</p>

<pre><code>sudo vi /etc/apache2/users/[username].conf
</code></pre>

<p>Copy and paste the following into the new conf file.</p>

<pre><code>&lt;Directory /&gt;
    Options FollowSymLinks Indexes MultiViews
    AllowOverride All
    Order allow,deny
    Allow from all
&lt;/Directory&gt;
</code></pre>

<h2>Install &amp; Configure Git</h2>

<p>Download and install the latest version of Git for Mac <a href="http://git-scm.com">here</a>. Reboot after the install and then configure.</p>

<pre><code>sudo reboot
git config --global user.name 'username'
git config --global user.email 'email'
</code></pre>

<p>Setup your password in the OS X keychain.</p>

<pre><code>git credential-osxkeychain
git config --global credential.helper osxkeychain
</code></pre>

<h2>Configure Virtual Hosts</h2>

<p>Use vi to configure the hosts file.</p>

<pre><code>sudo vi /etc/hosts
</code></pre>

<p>Add a virtual hostname for each website.</p>

<pre><code>127.0.0.1 [example].localhost
</code></pre>

<p>Configure directories and logs for apache.</p>

<pre><code>sudo vi /etc/apache2/extra/httpd-vhosts.conf
</code></pre>

<p>Copy and past this block for each website.</p>

<pre><code>&lt;VirtualHost *:80&gt;
    DocumentRoot '/path/to/web/folder'
    ServerName [example].localhost
&lt;/VirtualHost&gt;
</code></pre>

<h2>Setup Self-Signed SSL Certificate</h2>

<p>When setting up the SSL certificate below, leave all questions blank.</p>

<pre><code>cd /etc/apache2
sudo ssh-keygen -f server.key
sudo openssl req -new -key server.key -out request.csr
sudo openssl x509 -req -days 365 -in request.csr -signkey server.key -out server.crt
sudo openssl rsa -in server.key -out server.nopass.key
sudo vi /etc/apache2/extra/httpd-ssl.conf
</code></pre>

<p>Configure HTTPS virtual hosts.</p>

<pre><code>DocumentRoot '/path/to/web/folder';
ServerName [example].localhost
...
SSLCertificateFile '/etc/apache2/server.crt';
SSLCertificateKeyFile '/etc/apache2/server.nopass.key';
</code></pre>

<h2>Install &amp; Configure MySQL</h2>

<ul>
<li>Download and install MySQL from the <a href="http://www.mysql.com/downloads/mysql/">download page</a>.</li>
<li>Make sure it's the 64-bit DMG archive version</li>
</ul>

<p>Create config file from default.</p>

<pre><code>sudo cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf
sudo vi /etc/my.cnf
</code></pre>

<p>Enter the following config into my.cnf:</p>

<pre><code>[mysqld]
...
default_time_zone = '+00:00'
datadir = /Volumes/ramdisk/data
innodb_flush_log_at_trx_commit = 2
innodb_data_home_dir = /Volumes/ramdisk/data
</code></pre>

<p>Create a bash profile to set the MySQL path and aliases.</p>

<pre><code>sudo vi ~/.bash_profile
</code></pre>

<p>Add these lines to the file:</p>

<pre><code>export PATH="/usr/local/mysql/bin:$PATH"
alias ramdisk_setup='/path/to/ramdisk_setup.sh'
alias mysql_setup='/path/to/mysql_setup.sh'
</code></pre>

<p>Here is the ramdisk_setup.sh script:</p>

<pre><code>#!/bin/bash
/usr/local/mysql/bin/mysqladmin -u root shutdown
sudo diskutil umount force /Volumes/ramdisk
sudo umount -f /Volumes/ramdisk

diskname=`hdiutil attach -nomount ram://2048000`
newfs_hfs -v ramdisk /dev/disk1
sudo rm -R /Volumes/ramdisk
sudo mkdir /Volumes/ramdisk
sudo mount_hfs -u _mysql -g wheel -w -m 777 /dev/disk1 /Volumes/ramdisk
sudo cp -R /usr/local/mysql/data /Volumes/ramdisk/data

cd /Volumes/ramdisk
sudo chown -R _mysql:wheel /Volumes/ramdisk
sudo chmod -R 777 /Volumes/ramdisk
/usr/local/mysql/support-files/mysql.server start
sudo chown -R _mysql:wheel /Volumes/ramdisk
sudo chmod -R 777 /Volumes/ramdisk'
</code></pre>

<p>Here is the mysql_setup.sh script:</p>

<pre><code>/usr/local/mysql/support-files/mysql.server start

mysql -u root -e "create database if not exists [database];"
mysql -u root -e "create user '[username]' identified by '[password]';"
mysql -u root -e "grant all privileges on *.* to [database]@localhost;"
mysql -u root -e "use mysql; update user set password=password('[password]') where user ='[username]';"
mysql -u root -e "flush privileges;"

/usr/local/mysql/support-files/mysql.server stop
/usr/local/mysql/support-files/mysql.server start
</code></pre>

<p>Reload your profile.</p>

<pre><code>su - [username]
</code></pre>

<h2>Configure php.ini</h2>

<p>Enable the php.ini file and open it for editing.</p>

<pre><code>sudo cp /etc/php.ini.default /etc/php.ini
sudo vi /etc/php.ini
</code></pre>

<p>Change the timezone and unix socket path for MySQL to ramdisk.</p>

<pre><code>date.timezone = UTC
...
pdo_mysql.default_socket=/tmp/mysql_ram.sock
...
detect_unicode = Off (at end, doesn't yet exist)
</code></pre>

<h2>Start Services</h2>

<p>Restart Apache and use the pref pane to start MySQL.</p>

<pre><code>sudo apachectl restart
</code></pre>

<h2>Optional Extras</h2>

<p>Start visudo to change user settings.</p>

<pre><code>sudo visudo
</code></pre>

<p>Add this line to remove the need to enter your password:</p>

<pre><code>[username] ALL=(ALL) NOPASSWD: ALL
</code></pre>

<p>Install composer if necessary.</p>

<pre><code>curl -s http://getcomposer.org/installer | php
php composer.phar install
</code></pre>

<p>Set permissions on cache and logs.</p>

<pre><code>cd /path/to/web/folder
sudo rm -rf app/cache/*
sudo rm -rf app/logs/*
sudo chmod +a "www allow delete,write,append,file_inherit,directory_inherit" app/cache app/logs
sudo chmod +a "`whoami` allow delete,write,append,file_inherit,directory_inherit" app/cache app/logs
</code></pre>

<p>Install Java by initiating the installer.</p>

<pre><code>java -version
</code></pre>
<!-- END UPDATE -->

<footer>&copy; Todd Sullivan</footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-40661262-1', 'todsul.com');
ga('send', 'pageview');
</script>

</body>

</html>
